---
name: text-to-canvas
description: 将文字、文档、概念等内容智能转化为Obsidian Canvas可视化图形。当用户说出"将这段文字转化为图"、"把这个文档可视化"、"给我画一张思维导图"等触发词时使用。支持思维导图、流程图、知识图谱、时间线等多种图形类型，采用半自动流程：AI分析规划→展示草稿→用户确认→生成保存。
---

# Text to Canvas - 智能文档可视化

## 触发条件

当用户说出以下任一触发词时，激活此skill：
- "将这段文字转化为图"
- "把这个文档可视化"
- "给我画一张思维导图"
- "转化为可视化图"
- "生成思维导图"
- "可视化这篇文章/概念/内容"

## 工作流程

### 阶段1：内容获取与分析

**输入类型识别：**
1. **直接文本**：用户直接粘贴的文字内容
2. **本地文件**：用户提供文件路径（支持 .txt, .md, .docx, .pptx, .pdf）
3. **概念/主题**：用户给出一个概念名称，需要进一步询问具体内容

**内容提取步骤：**
1. 如果是文件路径，使用对应工具读取内容：
   - `.txt/.md`：直接读取
   - `.docx`：使用docx skill提取
   - `.pptx`：提取大纲和关键内容
   - `.pdf`：提取文本内容
2. 如果是概念/主题，询问用户："请提供关于'[概念]'的具体内容或描述"

### 阶段2：智能规划

分析内容特征，自动选择最适合的图形类型：

**图形类型选择矩阵：**

| 内容特征 | 推荐图形类型 | 适用场景 |
|---------|-------------|---------|
| 层级结构明显（大纲、目录） | 思维导图 (MindMap) | 知识框架、概念体系 |
| 步骤/流程描述 | 流程图 (Flowchart) | 操作流程、决策路径 |
| 多概念关联 | 知识图谱 (Knowledge Graph) | 概念关系、网络结构 |
| 时间序列/历史事件 | 时间线 (Timeline) | 发展历程、项目里程碑 |
| 对比/分类 | 矩阵图/分类图 | 对比分析、分类体系 |
| 复杂多维度 | 混合视图 | 综合型内容 |

**规划内容应包含：**
1. **图形类型**：选择的可视化类型及理由
2. **核心主题**：内容的中心主题
3. **主要节点**：3-7个关键节点/概念
4. **节点关系**：节点间的连接方式
5. **布局建议**：整体结构布局

### 阶段3：展示规划草稿

向用户展示规划结果，格式如下：

```
## 📋 可视化规划方案

**内容主题**：[提取的主题]
**推荐图形**：思维导图 / 流程图 / 知识图谱 / 时间线
**选择理由**：[为什么选择这种图形]

**结构规划**：
- 中心节点：[核心概念]
- 分支1：[子概念1] → [关联细节]
- 分支2：[子概念2] → [关联细节]
- 分支3：[子概念3] → [关联细节]
...

**预期效果**：
[描述这张图将呈现什么样的视觉效果和信息层次]

请确认此规划方案，或提出修改建议。
- 回复"确认"或"开始生成"继续
- 提出修改意见（如"把X和Y合并"、"增加Z节点"等）
```

### 阶段4：用户确认

等待用户反馈：
- **确认**：进入生成阶段
- **修改**：调整规划后再次展示，直到用户满意
- **取消**：停止任务

### 阶段5：生成Canvas

使用 `obsidian-canvas-creator` skill 生成.canvas文件：

**文件名格式**：
```
{YYYY-MM-DD}_{主题关键词}.canvas
例如：2024-02-18_AI发展趋势.canvas
```

**生成步骤：**
1. 根据确认的规划方案，设计完整的节点和连接
2. 调用 `obsidian-canvas-creator` skill
3. 使用 `session_id` 继续对话，提示词示例：

```
请基于以下规划生成Obsidian Canvas：

**主题**：[主题]
**布局类型**：[mindmap/freeform]
**节点清单**：
1. 节点1 (x, y): 内容
2. 节点2 (x, y): 内容
3. 节点3 (x, y): 内容
...

**连接关系**：
- 节点1 → 节点2
- 节点1 → 节点3
...

**样式要求**：
- 中心节点：突出显示
- 层级分明
- 颜色区分不同分支
- **布局对齐：同层级节点必须对齐（相同X或Y坐标），使用统一间距**

**布局对齐要求（CRITICAL）**：
1. **水平对齐**：同一层级的节点Y坐标必须相同
2. **垂直对齐**：同一列的节点X坐标必须相同  
3. **等距分布**：同级节点间距保持一致（建议150-200px）
4. **网格系统**：坐标使用50px或100px的倍数，避免杂乱数值
5. **参考planning-guide.md中的"布局对齐规范"章节获取详细指导**

保存路径：/Users/mumu/Downloads/obsidian/canvas/{文件名}.canvas
```

### 阶段6：保存与确认

1. 确保文件成功保存到 `/Users/mumu/Downloads/obsidian/canvas/`
2. 告知用户：
   - 文件保存路径
   - 文件名称
   - 如何在Obsidian中打开

## 示例对话

### 示例1：直接文本

**用户**：将这段文字转化为图
「人工智能发展经历了三个阶段：符号主义、连接主义和行为主义。符号主义基于逻辑推理，连接主义基于神经网络，行为主义基于感知-行动。」

**AI**：
## 📋 可视化规划方案

**内容主题**：人工智能发展流派
**推荐图形**：思维导图（MindMap）
**选择理由**：内容呈现清晰的层级结构（中心主题→三大流派→各自特点），适合用思维导图展示概念体系

**结构规划**：
- 中心节点：人工智能发展流派
- 分支1：符号主义
  - 核心方法：逻辑推理
- 分支2：连接主义  
  - 核心方法：神经网络
- 分支3：行为主义
  - 核心方法：感知-行动

**预期效果**：以AI流派为中心，三个分支分别展示三种主义的名称和核心方法，层次清晰，便于理解对比

请确认此规划方案，或提出修改建议。

**用户**：确认

**AI**：[生成canvas并保存] 已完成！文件保存在：`/Users/mumu/Downloads/obsidian/canvas/2024-02-18_AI发展流派.canvas`

### 示例2：文档文件

**用户**：把这个文档可视化 /Users/mumu/docs/项目计划.docx

**AI**：[读取文件内容后] 
## 📋 可视化规划方案

**内容主题**：Q1产品迭代计划
**推荐图形**：时间线（Timeline）+ 流程图混合
**选择理由**：文档包含项目时间节点和任务流程，时间线适合展示里程碑，流程图适合展示任务依赖

**结构规划**：
- 时间线节点：1月需求确认 → 2月开发 → 3月测试 → 4月上线
- 每个节点内包含：关键任务、负责人、交付物

...

## 注意事项

1. **内容长度控制**：
   - 如果内容过长（>2000字），提取核心要点，避免节点过多
   - 可询问用户："内容较长，是否只提取关键要点？"

2. **图形复杂度**：
   - 节点数量建议控制在 5-15 个
   - 连接关系不要过于复杂（避免超过20条连接）

3. **用户意图判断**：
   - 如果用户提供的是代码，建议用流程图展示执行流程
   - 如果用户提供的是会议纪要，建议用思维导图展示决议和行动项
   - 如果用户提供的是历史/发展类内容，建议用时间线

4. **错误处理**：
   - 文件读取失败时，告知用户并询问是否可以提供文本内容
   - ob-canvas生成失败时，重试一次，仍失败则建议使用其他格式

## 工具调用

**必用工具**：
- `obsidian-canvas-creator` skill：用于生成.canvas文件

**条件工具**：
- `docx` skill：读取Word文档
- `pdf` skill：读取PDF文件
- `read` tool：读取本地文本文件
- `pptx` skill：读取PPT大纲
